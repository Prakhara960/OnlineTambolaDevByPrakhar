<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambola • Family</title>
<!-- Simple modern styling -->
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent: #ffb86b;
    --muted:#9aa4b2;
    --glass: rgba(255,255,255,0.03);
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
  }
  body{background:linear-gradient(180deg,#071028 0%, #0f1724 100%);color:#e6eef6;margin:0;padding:28px;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
  .container{width:100%;max-width:1100px;}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6);margin-bottom:12px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1;min-width:240px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input,select,button{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:#eaf2ff;width:100%;box-sizing:border-box}
  button{cursor:pointer;border:none;background:linear-gradient(90deg,var(--accent),#ffdca0);color:#06202a;font-weight:600}
  .small{font-size:13px;color:var(--muted)}
  .players{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .player{background:#071227;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
  .ticket{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .num{width:36px;height:36px;border-radius:6px;display:flex;align-items:center;justify-content:center;background:#071a2b;border:1px solid rgba(255,255,255,0.02)}
  .called{background:#123b2a;color:#bff0d6;border:1px solid rgba(255,255,255,0.03)}
  .bigboard{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .boardnum{width:46px;height:46px;border-radius:6px;background:#071227;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.02)}
  footer{margin-top:18px;color:var(--muted);font-size:13px}
  .center{display:flex;align-items:center;gap:8px}
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Tambola • Family (Static + GAS)</h1>
      <div class="small">Host/Join with code • GitHub Pages + Google Apps Script</div>
    </header>

    <div class="card row">
      <div class="col">
        <label>Host naam</label>
        <input id="hostName" placeholder="Host ka naam (ex: Ramesh)" />
      </div>
      <div class="col">
        <label>Dividend names (comma separated)</label>
        <input id="divNames" value="Full House,Top Line,First Five" />
      </div>
      <div class="col" style="max-width:220px">
        <label>Dividend amounts (comma)</label>
        <input id="divAmounts" value="500,200,100" />
      </div>
      <div class="col" style="max-width:180px;display:flex;align-items:flex-end">
        <button id="createBtn">Create Host (Generate Code)</button>
      </div>
    </div>

    <div class="card row">
      <div class="col">
        <label>Join Game (enter code)</label>
        <input id="joinCode" placeholder="Game code jaise ABC12" />
      </div>
      <div class="col">
        <label>Player name</label>
        <input id="playerName" placeholder="Aapka naam" />
      </div>
      <div class="col" style="max-width:160px;display:flex;align-items:flex-end">
        <button id="joinBtn">Join</button>
      </div>
      <div class="col small">OR open same page and paste code to join.</div>
    </div>

    <div id="gameArea" style="display:none">
      <div class="card">
        <div class="row">
          <div class="col">
            <div class="center">
              <strong>Game Code:</strong> <div id="gameCode" style="margin-left:10px;color:var(--accent)"></div>
              <div style="margin-left:12px" class="small">Status: <span id="gameStatus">–</span></div>
            </div>

            <div style="margin-top:10px">
              <div class="small">Players:</div>
              <div id="playersList" class="players"></div>
            </div>

            <div style="margin-top:10px">
              <div class="small">Your Ticket:</div>
              <div id="myTicket" class="ticket"></div>
            </div>
          </div>

          <div class="col" style="max-width:360px">
            <div class="small">Dividends</div>
            <div id="divList"></div>

            <div style="margin-top:12px">
              <button id="startBtn">Start Game (Host only)</button>
            </div>

            <div style="margin-top:12px">
              <label>Call number (host)</label>
              <input id="callNumber" placeholder="1-90" />
              <button id="callBtn" style="margin-top:8px">Call Number</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="small">Numbers Called</div>
        <div id="board" class="bigboard"></div>
      </div>
    </div>

    <footer>Made for family tambola • Host on GitHub Pages + use Google Apps Script as backend</footer>
  </div>

<script>
/* ---------- CONFIG: change this to your Apps Script web app URL ---------- */
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwey0G9zdvsci6yc3pnjrC808Vy8neCmKXJJthVRbsAxH68m41TgQZtX9lhtsOBRoGJ2w/exec';
/* --------------------------------------------------------------------- */

let state = null;
let myName = '';
let myTicket = null;
let pollInterval = null;

function api(action, body){
  const url = action === 'get' ? `${SCRIPT_URL}?action=get&id=${encodeURIComponent(body.id)}` : SCRIPT_URL + '?action=' + action;
  if (action === 'get') {
    return fetch(url).then(r=>r.json());
  } else {
    return fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)})
      .then(r=>r.json());
  }
}

document.getElementById('createBtn').addEventListener('click',async ()=>{
  const host = document.getElementById('hostName').value || 'Host';
  const dn = document.getElementById('divNames').value.split(',').map(s=>s.trim()).filter(Boolean);
  const da = document.getElementById('divAmounts').value.split(',').map(s=>Number(s.trim())||0);
  const res = await api('create',{host, dividendNames: dn, dividendAmounts: da});
  if (res && res.ok) {
    openGame(res.id);
  } else alert('Create failed');
});

document.getElementById('joinBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('joinCode').value.trim();
  const name = document.getElementById('playerName').value.trim() || 'Player'+Math.floor(Math.random()*99);
  if (!id) return alert('Code daalo');
  const res = await api('join', {id, name});
  if (res && res.ok) {
    myName = name;
    myTicket = res.ticket;
    openGame(id);
  } else {
    alert('Join failed: ' + (res.error||'unknown'));
  }
});

function openGame(id){
  document.getElementById('gameArea').style.display = 'block';
  document.getElementById('gameCode').innerText = id;
  startPolling(id);
}

document.getElementById('startBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('gameCode').innerText;
  await api('start',{id});
});

document.getElementById('callBtn').addEventListener('click', async ()=>{
  const id = document.getElementById('gameCode').innerText;
  const n = Number(document.getElementById('callNumber').value);
  if (!n || n<1 || n>90) return alert('1-90 number daalo');
  await api('call',{id, number: n});
  document.getElementById('callNumber').value = '';
});

async function poll(id){
  const res = await api('get',{id});
  if (!res || !res.ok) return;
  state = res.data;
  // update UI
  document.getElementById('gameStatus').innerText = state.status;
  // players
  const pl = document.getElementById('playersList'); pl.innerHTML = '';
  (state.players || []).forEach(p=>{
    const el = document.createElement('div'); el.className='player'; el.innerText = p;
    pl.appendChild(el);
  });
  // ticket for me
  if (myTicket) renderTicket(myTicket);
  else if (state.tickets && myName && state.tickets[myName]) {
    myTicket = state.tickets[myName];
    renderTicket(myTicket);
  }
  // dividends
  const dl = document.getElementById('divList'); dl.innerHTML='';
  (state.settings && state.settings.dividendNames || []).forEach((dn,i)=>{
    const amt = (state.settings.dividendAmounts && state.settings.dividendAmounts[i]) || 0;
    const div = document.createElement('div'); div.className='small'; div.innerText = `${dn} — ₹${amt}`;
    dl.appendChild(div);
  });
  // board
  renderBoard(state.numbersCalled || []);
}

function renderTicket(ticket){
  const target = document.getElementById('myTicket'); target.innerHTML='';
  (ticket || []).forEach(n=>{
    const el = document.createElement('div'); el.className='num'; el.innerText = n;
    if (state && state.numbersCalled && state.numbersCalled.indexOf(n)!==-1) el.classList.add('called');
    target.appendChild(el);
  });
}

function renderBoard(called){
  const b = document.getElementById('board'); b.innerHTML='';
  for (let i=1;i<=90;i++){
    const el = document.createElement('div'); el.className='boardnum'; el.innerText = i;
    if (called && called.indexOf(i)!==-1) el.classList.add('called');
    b.appendChild(el);
  }
}

function startPolling(id){
  if (pollInterval) clearInterval(pollInterval);
  pollInterval = setInterval(()=>poll(id),1500);
  poll(id);
}

// if user opens page with ?code=XYZ, auto-fill
const params = new URLSearchParams(location.search);
if (params.get('code')) {
  document.getElementById('joinCode').value = params.get('code');
}
</script>
</body>
</html>
